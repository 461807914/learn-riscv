# 一、 CPU架构

## 1.1 概述

**指令集**：处理器进行操作的最小单元。

**微架构**：处理器具体硬件实现方案。

指令集架构是硬件与软件的桥梁，**也是区分不同CPU的主要标准，比如x86**指令集架构包括：

1. 数据类型
2. 存储模型
3. 软件可见状态（通用寄存器，程序计数器，处理器状态）
4. 指令集（指令类型与编码，寻址模式，数据结构）
5. 系统模型（状态，特权级别，中断和异常）
6. 外部接口（输入输出接口，管理）



### 1.1.1 CISC与RISC

CISC指令数量较多，包括较多不常用的特殊指令。RISC只包含常用指令，不常用的指令通过执行多条常用指令达到效果。

**指令集架构位数**：指通用寄存器的宽度，决定了寻址范围大小和数据运算能力的强弱。

32位架构处理器，通用寄存器宽度为32，寻址范围$2^{32}$，运算指令可以操作的位数为32.

指令集架构的宽度和指令的编码长度无任何关系。即，不是说64位架构的指令长度位64位，理论上来说，指令编码长度越短越好，可以节省代码存储空间。

常见架构位数位8，16，32，64



### 1.1.2 架构代表

**x86**，intel推出的复杂指令集，AMD的cpu也是x86架构。x86架构是具有代表性的可变指令长度的CISC架构。

**微码化**，将复杂的CISC指令先用硬件解码器翻译成对应的内部简单指令（微码）序列，然后送给处理器的流水线执行。x86使用这种技巧克服了CISC的部分缺点，使其称为一种RISC形式。但是会有一定的开销。



**SPARC**，sun公司的指令集架构，是一种RISC架构，面向服务器领域涉及，有72到640多个通用寄存器，64个一组。后来无了=_=



**MIPS**，一种简洁优化的RISC架构，最经典的RISC架构。路由器，游戏机上用的多。



**POWER**，IBM的RISC架构，主要用在服务器上。



**Alpha**，一种64位的RISC架构，DEC公司开发的。



**ARM**，没啥好说的，后面都是在说它。



**ARC**，Synopsys公司的32位RISC的IP。



## 1.2 ARM

全称为 advanced RISC Machines

Cortex-A：面向性能密集型系统处理器核心。

Cortex-R：面向实时应用的高性能核。

Cortex-M：面向嵌入式。



# 二、RISC-V 架构

注意，RISC表示精简指令集；RISC-V为伯克利发明的特定指令集架构（属于RISC类型）

RISC-V是一个模块化架构，这是x86与ARM架构不具备的。

模块化的RISC-V架构能够选择不同模块进行组合，满足不同应用场景。

基本的RISC-V指令数有40多条，加上其它模块化指令共几十条。



## 2. 1 模块化指令子集

RISC-V 指令集使用模块化组织，每个模块使用一个英文字母表示。RISC-V 强制要求实现的指令集部分由字母I表示的基本整数指令子集。使用该整数指令子集，能完整实现软件编译。

RISC-V 的模块化指令集如下

| 基本指令集 | 指令数 |                      描述                       |
| :--------: | :----: | :---------------------------------------------: |
|   RV32I    |   47   | 32位地址空间与整数指令，支持32个通用整数寄存器  |
|   RV32E    |   47   |       RV32I的子集，支持16个通用整数寄存器       |
|   RV64I    |   59   |    64位地址空间与整数指令及一部分的整数指令     |
|   RV128I   |   71   | 128位地址空间与整数指令及一部分64位和32位的指令 |



| 扩展指令集 | 指令数 |                          描述                           |
| :--------: | :----: | :-----------------------------------------------------: |
|     M      |   8    |                   整数乘法与除法指令                    |
|     A      |   11   | 存储器原子操作指令和Load-Reserved/Store-Conditional指令 |
|     F      |   26   |                单精度（32比特）浮点指令                 |
|     D      |   26   |       双精度（64比特）浮点指令，必须支持F扩展指令       |
|     C      |   46   |                压缩指令，指令长度为16位                 |

以上称为通用组合，用字母G表示，因此RV32G表示RV32IMAFDC，同理RV64G表示RV64IMAFD。













